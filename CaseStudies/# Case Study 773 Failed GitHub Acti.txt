# Case Study: 773 Failed GitHub Actions (And How I Fixed Them)

**Date:** December 2024  
**Duration:** One very frustrating evening  
**Status:** Resolved  
**Lessons Learned:** Many

---

## The Problem

I logged into GitHub and saw **773 failed workflow notifications**. Every single push to my repos was triggering Terraform validation failures and GitHub Pages deployment errors.

My profile looked like this:
- ❌ Terraform Validate #66 - FAILED
- ❌ Deploy GitHub Pages #218 - FAILED  
- ❌ Terraform Validate #65 - FAILED
- ❌ Deploy GitHub Pages #217 - FAILED  
- ... (repeated 773 times)

**Impact:**
- Made my GitHub look broken and unprofessional
- That DevOps engineer who just followed me probably saw all the red X's
- Every commit triggered more failures
- Couldn't tell what was actually broken vs just noisy workflows

---

## How It Happened

I had added GitHub Actions workflows to automatically validate my Terraform code and deploy my portfolio site. Good idea in theory! But:

1. **Terraform validation workflow** was checking syntax on every push
2. I had **duplicate output definitions** in my Terraform code (main.tf AND outputs.tf defined the same outputs)
3. The workflow kept failing, but I kept pushing commits trying to fix other things
4. Each push triggered another workflow run → another failure notification
5. Over several days: 773 failed runs accumulated

**The kicker:** I didn't even realize it was happening because I wasn't checking the Actions tab.

---

## Investigation Process

### Step 1: Realize the Scope

First time I clicked the bell icon in GitHub:

```
773 notifications
```

My heart sank. Started clicking through them:
- Multi-Tier-App-Troubleshooting-Playground: Terraform Validate FAILED
- charles-bucher.github.io: Deploy GitHub Pages FAILED
- Same errors, over and over

### Step 2: Check the Actual Error

Clicked on one of the failed workflow runs. Saw:

```
Error: Duplicate output definition

  on outputs.tf line 2:
   2: output "frontend_public_ip" {

An output named "frontend_public_ip" was already defined at main.tf:208,1-28.
```

**Oh no.** I had copy-pasted the outputs into both files while learning Terraform. Classic beginner mistake.

### Step 3: Try to Fix It... and Make It Worse

I opened main.tf and found the output blocks around line 208. Deleted them. Pushed the commit.

**Result:** Different error!

```
Error: Argument or block definition required

  on main.tf line 208:
  208:  {

An argument or block definition is required here.
```

I had deleted the `output "name"` part but left the curly braces `{ }`. More broken syntax.

### Step 4: Getting Help

At this point, I was stuck. The file was corrupted and I didn't know Terraform well enough to fix it properly. 

**What I did:**
- Asked for help (Claude in this case)
- Got corrected versions of main.tf, outputs.tf, and variables.tf
- Replaced the broken files with clean versions

### Step 5: Test Locally Before Pushing

**This was the game-changer.** Instead of pushing and hoping:

```bash
cd Multi-Tier-App-Troubleshooting-Playground
terraform init -backend=false
terraform validate
```

Got errors locally first:
- Duplicate outputs → Fixed
- Missing SSH key file → Removed that resource
- Missing second subnet for RDS → Added it

Only when `terraform validate` showed "Success!" did I push.

### Step 6: Verify the Fix

```bash
git add .
git commit -m "Fix Terraform validation errors"
git push
```

Waited nervously... checked Actions tab...

✅ **Terraform Validate - PASSED**

First green checkmark in days!

---

## The Solution

**What I changed:**

1. **Removed duplicate outputs from main.tf** - Kept them only in outputs.tf
2. **Fixed broken resource blocks** - Removed incomplete aws_key_pair that referenced non-existent SSH key
3. **Added missing subnet** - RDS requires 2 subnets in different AZs
4. **Tested locally first** - `terraform validate` before every push
5. **Cleared notification backlog** - Marked all 773 as read to start fresh

**File structure:**
```
Multi-Tier-App-Troubleshooting-Playground/
├── main.tf         (cleaned, no outputs)
├── outputs.tf      (all outputs here)
├── variables.tf    (unchanged)
└── .github/
    └── workflows/
        └── terraform-validate.yml (working now!)
```

---

## Results

**Before:**
- 773 failed workflow runs
- Profile covered in red X's
- No idea what was actually broken
- Afraid to push commits

**After:**
- All workflows passing ✅
- Clean notification inbox
- Confidence in my Terraform code
- CI/CD actually useful now

**Time to fix:** About 2 hours (would have been 20 minutes if I had tested locally first)

---

## What I Learned

### Technical Skills

**Terraform Basics:**
- Output blocks go in outputs.tf, not main.tf
- Resources must be complete - can't have partial definitions
- Always validate locally before pushing to Git
- `terraform init -backend=false` is great for CI/CD testing

**GitHub Actions:**
- Check the Actions tab regularly, not just when things break
- Failed workflows still count against your commit history
- Each push triggers ALL workflows (can add up fast!)
- Workflows fail loudly - use that to your advantage

### Troubleshooting Approach

**What worked:**
1. Check the actual error message (not just "failed")
2. Test locally to reproduce the issue
3. Fix one thing at a time
4. Validate each fix before moving to next issue
5. Ask for help when stuck (saved me hours)

**What didn't work:**
1. Blindly pushing commits hoping it would fix itself
2. Editing files without understanding the syntax
3. Ignoring the error messages and hoping they'd go away

### Process Improvements

**Going forward:**
1. **Test locally ALWAYS** - Never push without validating first
2. **Check Actions tab after every push** - Catch failures early
3. **One feature per commit** - Easier to debug when things break
4. **Read the full error message** - Don't just see "FAILED" and panic
5. **Document what works** - Created this case study so I don't repeat mistakes

---

## Mistakes I Made

1. **Added CI/CD before understanding it** - Should have learned Terraform better first
2. **Didn't test workflows before deploying** - Assumed they'd work
3. **Ignored notifications for days** - Let 773 pile up instead of fixing immediately
4. **Panic-pushed fixes** - Made things worse by not testing locally
5. **Didn't read documentation** - Skipped Terraform docs on outputs

**Biggest mistake:** Not checking if workflows actually worked when I first set them up. I added them thinking "CI/CD is what professional projects have" without verifying they ran successfully.

---

## Code Before/After

**Before (broken main.tf):**
```hcl
# ... instance definitions ...

# Outputs (WRONG - duplicates from outputs.tf)
output "frontend_public_ip" {
  value = aws_instance.frontend.public_ip
}
 {  # <-- THIS IS BROKEN (I deleted the output line but left the braces)
  value = aws_instance.backend.private_ip
}
```

**After (fixed main.tf):**
```hcl
# ... instance definitions ...

# Outputs moved to outputs.tf
# (nothing here - clean ending)
```

**outputs.tf (correct):**
```hcl
output "frontend_public_ip" {
  description = "Public IP address of the frontend server"
  value       = aws_instance.frontend.public_ip
}

output "backend_private_ip" {
  description = "Private IP address of the backend server"  
  value       = aws_instance.backend.private_ip
}

output "db_endpoint" {
  description = "RDS database endpoint"
  value       = aws_db_instance.database.endpoint
}
```

---

## Timeline

**Day 1 (Monday):** Added Terraform validation workflow, seemed to work  
**Day 2-4 (Tue-Thu):** Made various commits, didn't check Actions tab  
**Day 5 (Friday evening):** Noticed 773 notifications, panic sets in  
**Friday 8pm:** Started debugging, made it worse  
**Friday 9pm:** Asked for help, got clean files  
**Friday 10pm:** Tested locally, confirmed fixes work  
**Friday 10:30pm:** Pushed fix, workflows pass ✅  
**Friday 11pm:** Wrote this case study while it's fresh

---

## What's Still Confusing

- When to use separate Terraform files vs one big main.tf?
- How to handle Terraform state in CI/CD (I'm using `-backend=false` for now)
- Best practices for Terraform repo structure
- How to test GitHub Actions locally before pushing

---

## Resources That Helped

- Terraform documentation on outputs
- GitHub Actions syntax reference
- Real-time help from Claude (game-changer when stuck)
- My backup files (thank god I made those!)

---

## Impact on My Profile

**Before the fix, when someone visited my GitHub:**
- Saw repos with red X's everywhere
- Looked like I don't test my code
- Gave impression of abandoned/broken projects

**After the fix:**
- Clean green checkmarks ✅
- Looks professional and maintained
- Shows I know how to use CI/CD properly

That DevOps engineer who followed me? He probably saw the red X's, but now when he checks back, he'll see I fixed everything. That's a good look - shows I can debug problems.

---

## Silver Lining

**This was actually a great learning experience:**
- Forced me to really understand Terraform file structure
- Learned how GitHub Actions work (the hard way)
- Got practice debugging in a time-pressured situation
- Now I know to test locally first - that lesson cost 773 failures, but I'll never forget it

**Quote I'll remember:** "Test locally, commit globally" (I just made that up, but it's true!)

---

**Status:** Workflows working reliably for 3+ days, no new failures  
**Confidence Level:** Much higher - I know how to fix this if it breaks again

*This was a humbling experience. But hey, at least I documented it so others (and future me) can learn from my mistakes. That's growth, right?*